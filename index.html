<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake</title>
    <style>
        #game-board {
            background-color: #ccc;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .snake-part {
            position: absolute;
            background-color: #000;
        }

        .food {
            position: absolute;
            height: 100px;
            width: 100px;
            background-color: blue;
        }
    </style>
</head>

<body>
    <div id="game-board"></div>

    <script>
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);

        const game = {
            gameBoard: $("#game-board"),
            gameBoardSize: { height: 12, width: 20 },
            snake: [
                { x: 20, y: 0 },
                { x: 10, y: 0 },
                { x: 0, y: 0 },
            ],
            snakeWidth: 10,
            snakeLength: 3,
            isReadyToTakeCommand: true,
            currentDirection: "right",
            commandsList: ["right"],
            commandsListLength: 1,
            interval: 200,

            start() {
                this.drawGameBoard();
                this.drawSnake();
                setInterval(() => {
                    console.log(this.commandsList, this.commandsListLength)
                    this.moveSnake();
                    this.handleSnakeControl();
                }, this.interval);
            },

            drawGameBoard() {
                Object.assign(this.gameBoard.style, {
                    height: `${this.gameBoardSize.height * this.snakeWidth}px`,
                    width: `${this.gameBoardSize.width * this.snakeWidth}px`,
                });
                this.renderFood();
            },

            newFoodPosition() {
                return {
                    x: 30,
                    y: 40,
                };
            },

            renderFood() {
                this.gameBoard.innerHTML += '<div class="food"></div>';
                foodPosition = this.newFoodPosition();
                Object.assign($(".food").style, {
                    width: `${this.snakeWidth}px`,
                    height: `${this.snakeWidth}px`,
                    top: `${foodPosition.y}px`,
                    left: `${foodPosition.x}px`,
                });
                console.log($('.food'))
            },

            drawSnake() {
                // Clear game board
                const oldSnakePart = $$('#game-board > :not(.food)');
                for (let i = 0; i < oldSnakePart.length; i++) {
                    oldSnakePart[i].remove();
                }

                //Draw
                this.snake.forEach((element, index) => {
                    this.gameBoard.innerHTML += `<div class="snake-part id-${index}"></div>`;
                    const snakePart = $(`.snake-part.id-${index}`);
                    Object.assign(snakePart.style, {
                        width: `${this.snakeWidth}px`,
                        height: `${this.snakeWidth}px`,
                        top: `${this.snake[index].y}px`,
                        left: `${this.snake[index].x}px`,
                    });
                });
            },

            moveSnake() {
                const snakeHead = this.snake[0];

                // Direction moving handling
                switch (this.currentDirection) {
                    case "up":
                        this.snake = [
                            { x: snakeHead.x, y: snakeHead.y - this.snakeWidth },
                            ...this.snake,
                        ];
                        this.snake.pop();
                        break;
                    case "right":
                        this.snake = [
                            { x: snakeHead.x + this.snakeWidth, y: snakeHead.y },
                            ...this.snake,
                        ];
                        this.snake.pop();
                        break;
                    case "down":
                        this.snake = [
                            { x: snakeHead.x, y: snakeHead.y + this.snakeWidth },
                            ...this.snake,
                        ];
                        this.snake.pop();
                        break;
                    case "left":
                        this.snake = [
                            { x: snakeHead.x - this.snakeWidth, y: snakeHead.y },
                            ...this.snake,
                        ];
                        this.snake.pop();
                        break;
                }
                this.drawSnake();

                this.isReadyToTakeCommand = true;
            },

            commandsListUpdate() {
                document.addEventListener("keydown", (event) => {
                    switch (event.key) {
                        case "ArrowUp":
                        case "w":
                            if (
                                this.commandsList[this.commandsListLength - 1] !== "down" &&
                                this.commandsList[this.commandsListLength - 1] !== "up"
                            ) {
                                this.commandsList.push("up");
                                this.commandsListLength++;
                            }
                            break;
                        case "ArrowRight":
                        case "d":
                            if (
                                this.commandsList[this.commandsListLength - 1] !== "left" &&
                                this.commandsList[this.commandsListLength - 1] !== "right"
                            ) {
                                this.commandsList.push("right");
                                this.commandsListLength++;
                            }
                            break;
                        case "ArrowDown":
                        case "s":
                            if (
                                this.commandsList[this.commandsListLength - 1] !== "up" &&
                                this.commandsList[this.commandsListLength - 1] !== "down"
                            ) {
                                this.commandsList.push("down");
                                this.commandsListLength++;
                            }
                            break;
                        case "ArrowLeft":
                        case "a":
                            if (
                                this.commandsList[this.commandsListLength - 1] !== "right" &&
                                this.commandsList[this.commandsListLength - 1] !== "left"
                            ) {
                                this.commandsList.push("left");
                                this.commandsListLength++;
                            }
                            break;
                    }
                });
            },

            handleSnakeControl() {
                this.commandsListUpdate();
                if (this.isReadyToTakeCommand) {
                    if (this.commandsListLength) {
                        this.currentDirection = this.commandsList.shift();
                        this.commandsListLength--;
                    }
                    this.isReadyToTakeCommand = false;
                }
            },
        };

        game.start();
    </script>
</body>

</html>